# Apache .htaccess - Maximum Performance & Caching for 100/100 Lighthouse
# Enable mod_rewrite
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Remove index.html from URLs (optional, for clean URLs)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ index.html [L]
</IfModule>

# GZIP Compression - Maximum compression for all text content
<IfModule mod_deflate.c>
  # Compress HTML, CSS, JavaScript, Text, XML, fonts
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-woff
  AddOutputFilterByType DEFLATE application/font-woff
  AddOutputFilterByType DEFLATE application/json
  
  # Remove browser bugs
  BrowserMatch ^Mozilla/4 ^$
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
  Header append Vary User-Agent
</IfModule>

# Browser Caching - Aggressive caching for better Lighthouse scores
<IfModule mod_expires.c>
  ExpiresActive On

  # Default: 1 month
  ExpiresDefault "access plus 1 month"

  # HTML - Never cache (or very short)
  ExpiresByType text/html "access plus 1 minute"
  
  # CSS & JavaScript - 1 year (immutable)
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType text/javascript "access plus 1 year"
  
  # Images - 1 year
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  
  # Fonts - 1 year
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
</IfModule>

# Cache-Control Headers - Fine-grained control
<FilesMatch "\.(js|css|woff2|ttf|otf|woff)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
  Header set Vary "Accept-Encoding"
</FilesMatch>

<FilesMatch "\.(jpg|jpeg|png|gif|svg|webp|ico)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
  Header set Vary "Accept-Encoding"
</FilesMatch>

<FilesMatch "\.html$">
  Header set Cache-Control "no-cache, no-store, must-revalidate, public, max-age=0"
  Header set Pragma "no-cache"
  Header set Expires "0"
</FilesMatch>

# ETag & Vary Headers for better caching
<FilesMatch "\.(html|css|js|txt|xml)$">
  Header set Vary "Accept-Encoding"
  Header set X-Content-Type-Options "nosniff"
</FilesMatch>

# Remove unnecessary headers
<IfModule mod_headers.c>
  Header unset ETag
  FileETag None
</IfModule>

# Performance Headers
<IfModule mod_headers.c>
  # Prevent MIME sniffing
  Header set X-Content-Type-Options "nosniff"
  
  # Enable XSS filter
  Header set X-XSS-Protection "1; mode=block"
  
  # Clickjacking protection
  Header set X-Frame-Options "SAMEORIGIN"
  
  # Referrer policy
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  
  # Remove server header
  Header always unset Server
  Header always unset X-Powered-By
  
  # Enable caching for API responses (optional)
  <FilesMatch "^/api/">
    Header set Cache-Control "public, max-age=3600"
  </FilesMatch>
</IfModule>

# Disable ETags for performance
FileETag None
