const API_URL="localhost"===window.location.hostname?"http://localhost:5000/api":"/api";class Search{constructor(){this.searchInput=document.getElementById("search-input"),this.searchResults=document.getElementById("search-results"),this.searchOverlay=document.getElementById("search-overlay"),this.searchClose=document.getElementById("search-close"),this.searchButton=document.getElementById("search-button"),this.init()}init(){this.searchInput&&(this.searchInput.addEventListener("input",this.debounce(this.performSearch.bind(this),300)),this.searchInput.addEventListener("focus",this.showSearchResults.bind(this)),this.searchClose&&this.searchClose.addEventListener("click",this.hideSearchResults.bind(this)),this.searchButton&&this.searchButton.addEventListener("click",this.toggleSearch.bind(this)),document.addEventListener("click",e=>{!this.searchResults||this.searchResults.contains(e.target)||this.searchInput.contains(e.target)||this.hideSearchResults()}),this.searchInput.addEventListener("keypress",e=>{"Enter"===e.key&&this.submitSearch()}))}debounce(e,s){let t;return function(...c){clearTimeout(t),t=setTimeout(()=>{clearTimeout(t),e(...c)},s)}}async performSearch(){const e=this.searchInput.value.trim();if(e.length<2)this.showRecentSearches();else try{const s=await fetch(`${API_URL}/posts?search=${encodeURIComponent(e)}&limit=5`),t=await s.json();t.success&&this.displaySearchResults(t.posts,e)}catch(e){console.error("Search error:",e)}}displaySearchResults(e,s){if(!this.searchResults)return;if(!e||0===e.length)return void(this.searchResults.innerHTML=`\n                <div class="search-result-empty">\n                    <p>No results found for "<strong>${this.escapeHtml(s)}</strong>"</p>\n                    <p class="search-suggestion">Try different keywords or check spelling</p>\n                </div>\n            `);const t=`\n            <div class="search-result-header">\n                <h4>Search Results for "${this.escapeHtml(s)}"</h4>\n                <span class="search-result-count">${e.length} results</span>\n            </div>\n            ${e.map(e=>`\n                <a href="post.html?slug=${encodeURIComponent(e.slug)}" class="search-result-item">\n                    <div class="search-result-category">${this.escapeHtml(e.category)}</div>\n                    <h5>${this.escapeHtml(e.title)}</h5>\n                    <p class="search-result-excerpt">${this.escapeHtml(this.truncateText(e.excerpt||"",100))}</p>\n                    <div class="search-result-meta">\n                        <span>üìÖ ${new Date(e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}</span>\n                        <span>üëÅÔ∏è ${e.views||0} views</span>\n                    </div>\n                </a>\n            `).join("")}\n            ${e.length>=5?`\n                <div class="search-result-footer">\n                    <a href="index.html?search=${encodeURIComponent(s)}" class="search-view-all">\n                        View all results ‚Üí\n                    </a>\n                </div>\n            `:""}\n        `;this.searchResults.innerHTML=t,this.searchResults.style.display="block"}showRecentSearches(){if(!this.searchResults)return;const e=JSON.parse(localStorage.getItem("recentSearches")||"[]");if(0===e.length)return void(this.searchResults.innerHTML='\n                <div class="search-result-empty">\n                    <p>Type to search articles</p>\n                    <p class="search-suggestion">Try: "budgeting", "investing", "saving tips"</p>\n                </div>\n            ');const s=`\n            <div class="search-result-header">\n                <h4>Recent Searches</h4>\n                <button class="search-clear-recent" onclick="search.clearRecentSearches()">Clear</button>\n            </div>\n            ${e.map(e=>`\n                <div class="search-recent-item" onclick="search.setSearchTerm('${this.escapeHtml(e)}')">\n                    <span class="search-recent-icon">üîç</span>\n                    <span class="search-recent-term">${this.escapeHtml(e)}</span>\n                    <button class="search-recent-remove" onclick="event.stopPropagation(); search.removeRecentSearch('${this.escapeHtml(e)}')">√ó</button>\n                </div>\n            `).join("")}\n        `;this.searchResults.innerHTML=s,this.searchResults.style.display="block"}showSearchResults(){if(!this.searchResults)return;const e=this.searchInput.value.trim();0===e.length?this.showRecentSearches():e.length>=2&&this.performSearch(),this.searchResults.style.display="block"}hideSearchResults(){this.searchResults&&(this.searchResults.style.display="none")}toggleSearch(){if(this.searchOverlay){const e="flex"===this.searchOverlay.style.display;this.searchOverlay.style.display=e?"none":"flex",e||setTimeout(()=>{this.searchInput.focus()},100)}}submitSearch(){const e=this.searchInput.value.trim();0!==e.length&&(this.saveRecentSearch(e),window.location.href=`index.html?search=${encodeURIComponent(e)}`)}saveRecentSearch(e){const s=JSON.parse(localStorage.getItem("recentSearches")||"[]"),t=s.indexOf(e);-1!==t&&s.splice(t,1),s.unshift(e),s.length>5&&s.pop(),localStorage.setItem("recentSearches",JSON.stringify(s))}clearRecentSearches(){localStorage.removeItem("recentSearches"),this.showRecentSearches()}removeRecentSearch(e){const s=JSON.parse(localStorage.getItem("recentSearches")||"[]"),t=s.indexOf(e);-1!==t&&(s.splice(t,1),localStorage.setItem("recentSearches",JSON.stringify(s)),this.showRecentSearches())}setSearchTerm(e){this.searchInput&&(this.searchInput.value=e,this.searchInput.focus(),this.performSearch())}truncateText(e,s){return e.length<=s?e:e.substring(0,s)+"..."}escapeHtml(e){const s=document.createElement("div");return s.textContent=e,s.innerHTML}}let search=null;document.addEventListener("DOMContentLoaded",()=>{search=new Search,window.search=search});