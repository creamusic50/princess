document.addEventListener("DOMContentLoaded",()=>{loadPosts(),setupCategoryFilter(),setupSearch(),trackReadingProgress()});window.currentCategory = window.currentCategory || "all";window.currentPage = window.currentPage || 1;window.currentSearch = window.currentSearch || "";if (typeof currentCategory === 'undefined') currentCategory = window.currentCategory;if (typeof currentPage === 'undefined') currentPage = window.currentPage;if (typeof currentSearch === 'undefined') currentSearch = window.currentSearch;async function loadPosts(e=1,t="all",n=""){try{showLoading();let o=`${CONFIG.API_BASE_URL}/posts?page=${e}&limit=${CONFIG.POSTS_PER_PAGE}`;t&&"all"!==t&&(o+=`&category=${encodeURIComponent(t)}`),n&&(o+=`&search=${encodeURIComponent(n)}`);const a=await fetch(o),r=await a.json();r.success?(displayPosts(r.posts),updatePagination(r.currentPage,r.totalPages),currentPage=r.currentPage):showError("Failed to load posts")}catch(e){console.error("Error loading posts:",e),showError("Failed to load posts. Please try again.")}finally{hideLoading()}}function displayPosts(e){const t=document.querySelector(".blog-grid");t?e&&0!==e.length?t.innerHTML=e.map(e=>`\n        <article class="blog-card">\n            <div class="blog-card-content">\n                <span class="category-badge">${escapeHtml(e.category)}</span>\n                <h3><a href="post.html?slug=${e.slug}">${escapeHtml(e.title)}</a></h3>\n                <p class="excerpt">${escapeHtml(e.excerpt||"")}</p>\n                <div class="blog-card-meta">\n                    <span class="date">${formatDate(e.created_at)}</span>\n                    <span class="views">ðŸ‘ï¸ ${e.views||0} views</span>\n                    ${e.author_name?`<span class=\"author\">By ${escapeHtml(e.author_name)}</span>`:""}\n                </div>\n                <a href="post.html?slug=${e.slug}" class="read-more">Read More â†’</a>\n            </div>\n        </article>\n    `).join(""):t.innerHTML='\n            <div class="no-posts">\n                <p>No posts found. Try a different category or search term.</p>\n            </div>\n        ':console.error("Blog grid container not found")}function setupCategoryFilter(){const e=document.querySelectorAll(".category-btn");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),t.classList.add("active");const n=t.dataset.category;currentCategory=n,currentPage=1,loadPosts(currentPage,n,currentSearch)})})}function setupSearch(){const e=document.getElementById("search-input"),t=document.getElementById("search-btn");if(!e)return;let n;e.addEventListener("input",e=>{clearTimeout(n),n=setTimeout(()=>{currentSearch=e.target.value.trim(),currentPage=1,loadPosts(currentPage,currentCategory,currentSearch)},CONFIG.SEARCH_DEBOUNCE_MS)}),t&&t.addEventListener("click",()=>{currentSearch=e.value.trim(),currentPage=1,loadPosts(currentPage,currentCategory,currentSearch)})}function updatePagination(e,t){const n=document.querySelector(".pagination");if(!n||t<=1)return void(n&&(n.innerHTML=""));let o="";e>1&&(o+=`<button class=\"page-btn\" onclick=\"goToPage(${e-1})\">â† Previous</button>`);for(let n=1;n<=t;n++)1===n||n===t||n>=e-1&&n<=e+1?o+=`<button class=\"page-btn ${n===e?"active":""}\" onclick=\"goToPage(${n})\">${n}</button>`:n!==e-2&&n!==e+2||(o+='<span class="page-ellipsis">...</span>');e<t&&(o+=`<button class=\"page-btn\" onclick=\"goToPage(${e+1})\">Next â†’</button>`),n.innerHTML=o}function goToPage(e){window.scrollTo({top:0,behavior:"smooth"}),loadPosts(e,currentCategory,currentSearch)}function showLoading(){const e=document.querySelector(".blog-grid");e&&(e.innerHTML='\n            <div class="loading">\n                <div class="spinner"></div>\n                <p>Loading posts...</p>\n            </div>\n        ')}function hideLoading(){const e=document.querySelector(".loading");e&&e.remove()}function showError(e){const t=document.querySelector(".blog-grid");t&&(t.innerHTML=`\n            <div class=\"error-message\">\n                <p>âš ï¸ ${escapeHtml(e)}</p>\n                <button onclick=\"location.reload()\">Retry</button>\n            </div>\n        `)}function formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function trackReadingProgress(){if(!window.location.pathname.includes("post.html"))return;const e=document.createElement("div");e.className="reading-progress",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        height: 3px;\n        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);\n        width: 0%;\n        z-index: 9999;\n        transition: width 0.1s;\n    ",document.body.appendChild(e),window.addEventListener("scroll",()=>{const t=window.innerHeight,n=document.documentElement.scrollHeight,o=(window.pageYOffset||document.documentElement.scrollTop)/(n-t)*100;e.style.width=`${Math.min(o,100)}%`})}function sharePost(e,t){navigator.share?navigator.share({title:e,text:`Check out this article: ${e}`,url:t}).catch(e=>console.log("Share failed:",e)):navigator.clipboard.writeText(t).then(()=>{alert("Link copied to clipboard!")}).catch(e=>{console.error("Failed to copy:",e)})}function toggleBookmark(e){const t=JSON.parse(localStorage.getItem("bookmarks")||"[]"),n=t.indexOf(e);return-1===n?(t.push(e),localStorage.setItem("bookmarks",JSON.stringify(t)),!0):(t.splice(n,1),localStorage.setItem("bookmarks",JSON.stringify(t)),!1)}function isBookmarked(e){return JSON.parse(localStorage.getItem("bookmarks")||"[]").includes(e)}
